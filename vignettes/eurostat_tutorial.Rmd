---
title: "eurostat tutorial for R"
author: Leo Lahti, Przemyslaw Biecek, Markus Kainu and Janne Huovari
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
---
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{eurostat Markdown Vignette}
%\usepackage[utf8]{inputenc}
-->


Eurostat R tools
===========

This R package provides tools to access [Eurostat open
data](http://ec.europa.eu/eurostat/) as part of the
[rOpenGov](http://ropengov.github.io) project.

For contact information and source code, see the [github page](https://github.com/rOpenGov/eurostat)

## Installation

Release version:

```{r install, eval=FALSE}
install.packages("eurostat")
```

Development version:

```{r install2, eval=FALSE}
library(devtools)
install_github("ropengov/eurostat")
```

## Finding the data

Function `getEurostatTOC` downloads a table of contents of eurostat datasets. The values in column 'code' should be used to download a selected dataset.

```{r getEurostatTOC, warning=FALSE, message=FALSE}
library(eurostat)

# Get Eurostat data listing
toc <- getEurostatTOC()
toc[200:210,]
```

With `grepEurostatTOC` you can search the table of content for particular patterns, e.g. all datasets related to *passenger transport*.

```{r grepEurostatTOC, warning=FALSE, message=FALSE}
# info about passengers
head(grepEurostatTOC("passenger transport", type = "dataset"))
head(grepEurostatTOC("passenger transport", type = "table"))
```

## Downloading data 

Here an example of indicator ([Modal split of passenger transport](http://ec.europa.eu/eurostat/tgm/table.do?tab=table&init=1&plugin=1&language=en&pcode=tsdtr210)) in this document. This indicator is defined as the percentage share of each mode of transport in total inland transport, expressed in passenger-kilometres (pkm). It is based on transport by passenger cars, buses and coaches, and trains. All data should be based on movements on national territory, regardless of the nationality of the vehicle. However, the data collection is not harmonised at the EU level. 

Pick the code of the data you want to download: 
```{r get_code, warning=FALSE, message=FALSE, results='asis'}

id <- grepEurostatTOC("Modal split of passenger transport", 
        	             type = "table")$code[1]
```

Get table with the code. As the table is yearly data, it is more
convient to get time variable as numeric rather than in default date format

```{r get_eurostat, warning=FALSE, message=FALSE, results='asis'}
dat <- get_eurostat(id, time_format = "num")

```

Get idea what data includes
```{r str_dat, warning=FALSE, message=FALSE, results='asis'}
str(dat)
knitr::kable(head(dat))
```

### Replace codes with labels

Eurostat codes can be replaced with more labels. 
Function `label_eurostat()` replaces the eurostat codes with definitions 
from Eurostat dictionaries.

```{r labels, warning=FALSE, message=FALSE, results='asis'}
datl <- label_eurostat(dat)
knitr::kable(head(datl))
```

Vehicle information has 3 levels. They are:
```{r vehicle_levels}
levels(datl$vehicle)
```

You can get also labels for variable names
```{r name_labels}

label_eurostat_vars(names(datl))
```


## Selecting and modifing data

### EU data from 2012 in all vehicles:

```{r eu_12}

dat_eu12 <- subset(datl, geo == "European Union (28 countries)" & time == 2012)
knitr::kable(dat_eu12, row.names = FALSE)
```

### EU data from 2000 - 2012 with vehicle types as variables:
Reshaping the data is best done with `spread()` in `tidyr`.
```{r eu_vehicles_table}
library("tidyr")
dat_eu_0012 <- subset(dat, geo == "EU28" & 
                        time %in% 2000:2012)
dat_eu_0012_wide <- spread(dat_eu_0012, vehicle, value)
knitr::kable(subset(dat_eu_0012_wide, select = -geo), row.names = FALSE)
```

### Train passanger for selected EU countries in 2000 - 2012

```{r trains_table}
dat_trains <- subset(datl, geo %in% c("Austria", "Belgium", "Finland", "Sweden")
                     & time %in% 2000:2012 
                     & vehicle == "Trains")

dat_trains_wide <- spread(dat_trains, geo, value) 
knitr::kable(subset(dat_trains_wide, select = -vehicle), row.names = FALSE)
```

## Plot with ggplot2

The plotting is best done with package `ggplot2`

The train passanger data:

```{r trains_plot}
library("ggplot2")

ggplot(dat_trains, aes(x = time, y = value, colour = geo)) +
  geom_line()
```



## Triangle plot for split of passenger transport

With 2012 data for all countries with data.

```{r plotGallery, warning=FALSE, message=FALSE}
library(reshape)

allTransports <- spread(subset(dat, time == 2012, select = -time), vehicle, value)

allTransports <- na.omit(allTransports)

# triangle plot
library("plotrix")
triax.plot(allTransports[, -1], show.grid = TRUE, 
           label.points = TRUE, point.labels = allTransports$geo, 
           pch = 19)
```




## Citing the package

**Citing the Data** Kindly cite [Eurostat](http://ec.europa.eu/eurostat/). 

**Citing the R tools** This work can be freely used, modified and
distributed under the BSD-2-clause (modified FreeBSD) license:

```{r citation, message=FALSE, eval=TRUE}
citation("eurostat")
```

## Acknowledgements

This R package is based on earlier CRAN packages [statfi](http://cran.r-project.org/web/packages/statfi/index.html) and [smarterpoland](http://cran.r-project.org/web/packages/SmarterPoland/index.html). The [datamart](http://cran.r-project.org/web/packages/datamart/index.html) and [reurostat](https://github.com/Tungurahua/reurostat) packages seem to develop related Eurostat tools but at the time of writing this tutorial this package seems to be in an experimental stage. The [quandl](http://cran.r-project.org/web/packages/Quandl/index.html) package may also provides access to some versions of eurostat data sets.


## Session info

This tutorial was created with

```{r sessioninfo, message=FALSE, warning=FALSE}
sessionInfo()
```
