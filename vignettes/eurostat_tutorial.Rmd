---
output:
  html_document:
    theme: united
---
<!--
%\VignetteEngine{knitr}
%\VignetteIndexEntry{An R Markdown Vignette made with knitr}
-->


Eurostat R tools
===========

This R package provides tools to access [Eurostat open
data](http://ec.europa.eu/eurostat/portal/page/portal/statistics/themes)
as part of the [rOpenGov](http://ropengov.github.io) project.

For contact information and source code, see the [github page](https://github.com/rOpenGov/eurostat)

## Installation

Release version:

```{r install, eval=FALSE}
install.packages("eurostat")
```

Development version:

```{r install2, eval=FALSE}
library(devtools)
install_github("ropengov/eurostat")
```

## Finding the data

Function `getEurostatTOC` downloads a table of contents of eurostat datasets. Note that the values in column 'code' should be used to download a selected dataset.

```{r getEurostatTOC, warning=FALSE, message=FALSE}
library(eurostat)

# Get Eurostat data listing
toc <- getEurostatTOC()
toc[200:210,]
```

With `grepEurostatTOC` you can search through the table of content for particular patterns, e.g. all datasets related to *passenger transport*.

```{r grepEurostatTOC, warning=FALSE, message=FALSE}
# info about passengers
head(grepEurostatTOC("passenger transport", type = "dataset"))
head(grepEurostatTOC("passenger transport", type = "table"))
```



## Downloading the data 

Package has two functions for downloading the data. When using `get_eurostat_raw` the data is transformed into the tabular format, whereas `get_eurostat` returns dataset transformed into the molten / row-column-value format (RCV). Let's focus on indicator ([Modal split of passenger transport](http://ec.europa.eu/eurostat/tgm/table.do?tab=table&init=1&plugin=1&language=en&pcode=tsdtr210)) in this document. 

>This indicator is defined as the percentage share of each mode of transport in total inland transport, expressed in passenger-kilometres (pkm). It is based on transport by passenger cars, buses and coaches, and trains. All data should be based on movements on national territory, regardless of the nationality of the vehicle. However, the data collection methodology is not harmonised at the EU level. 



```{r get_eurostat_raw, warning=FALSE, message=FALSE, results='asis'}
# Pick ID for the table
id <- unique(grepEurostatTOC("Modal split of passenger transport", 
        	             type = "table")$code)
# Get table with the given ID
dat_raw <- get_eurostat_raw(id)
# lets use kable function from knitr for nicer table outputs
library(knitr)
kable(head(dat_raw))
```


```{r get_eurostat, warning=FALSE, message=FALSE, results='asis'}
dat <- get_eurostat(id)
kable(head(dat))
```


### Labelling the data

Function `label_eurostat`  replaces the eurostat codes with definitions from Eurostat dictionaries for data frames created using `get_eurostat`-function.

```{r label_eurostat, warning=FALSE, message=FALSE, results='asis'}
datl <- label_eurostat(dat)

kable(head(datl))
```


## Triangle plot for split of passenger transport

```{r plotGallery, warning=FALSE, message=FALSE}
library(reshape)
tmp <- get_eurostat("tsdtr210")
bus  <- cast(tmp, geo ~ time , mean, subset= vehicle=="BUS_TOT")
car <- cast(tmp, geo ~ time , mean, subset= vehicle=="CAR")
train   <- cast(tmp, geo ~ time , mean, subset= vehicle=="TRN")

# select 2010 data
allTransports <- data.frame(bus = bus[,"2010-01-01"], 
                            car = car[,"2010-01-01"],
                            train = train[,"2010-01-01"])
# add countrynames
rownames(allTransports) <- levels(bus[,1])
allTransports <- na.omit(allTransports)

# triangle plot
library("plotrix")
triax.plot(allTransports, show.grid=TRUE, 
           label.points=TRUE, point.labels=rownames(allTransports), 
           pch=19)
```


## Working with country codes

Eurostat is using ISO2 format for country names, OECD is using ISO3 for their studies, and Statistics Finland uses full country names. There are (at least) two ways to solve the issue. First one is to apply `label_eurostat`-function to your dataset.

```{r countrycodes1, warning=FALSE, message=FALSE, results='asis'}
tmp <- get_eurostat("tsdtr210")
tmpl <- label_eurostat(tmp)

kable(head(tmpl))
```

A second option is to use [countrycode](http://cran.r-project.org/web/packages/countrycode/index.html) package to convert between these formats.

```{r countrycodes, warning=FALSE, message=FALSE}
library("countrycode")

# Use the country codes from previous examples
countries <- rownames(allTransports)
head(countries)

# From ISO2 (used by Eurostat) into ISO3 (used by OECD)
head(countrycode(countries, "iso2c", "iso3c"))

# From ISO2 (used by Eurostat) into ISO (short country names)
head(countrycode(rownames(allTransports), "iso2c", "country.name"))
```

## Citing the package

**Citing the Data** Kindly cite [Eurostat](http://ec.europa.eu/eurostat/). 

**Citing the R tools** This work can be freely used, modified and
distributed under the [BSD-2-clause (modified FreeBSD)
license]. Kindly cite the R package as follows:

```{r citation, message=FALSE, eval=TRUE}
citation("eurostat")
```

## Acknowledgements

This R package is based on earlier CRAN packages [statfi](http://cran.r-project.org/web/packages/statfi/index.html) and [smarterpoland](http://cran.r-project.org/web/packages/SmarterPoland/index.html). The [datamart](http://cran.r-project.org/web/packages/datamart/index.html) and [reurostat](https://github.com/Tungurahua/reurostat) packages seem to develop related Eurostat tools but at the time of writing this tutorial this package seems to be in an experimental stage.


## Session info

This tutorial was created with

```{r sessioninfo, message=FALSE, warning=FALSE}
sessionInfo()
```
